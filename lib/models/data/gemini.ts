import { openproviders } from "@/lib/openproviders"
import { ModelConfig } from "../types"

const safeRequire = (name: string) => {
  try {
    return eval('require')(name)
  } catch {
    return null
  }
}

const getGeminiSdk = (modelId: string, apiKey?: string) => {
  // Try Vertex SDK first if project env var is provided
  if (process.env.GOOGLE_VERTEX_PROJECT) {
    const vertexMod = safeRequire("@ai-sdk/google-vertex") as any
    const vertexFn = vertexMod?.vertex
    if (typeof vertexFn === "function") {
      return vertexFn(modelId, {
        project: process.env.GOOGLE_VERTEX_PROJECT,
        location: process.env.GOOGLE_VERTEX_LOCATION || "us-central1",
      })
    }
  }

  // Fallback to Google Generative AI SDK (node / edge compatible ESM import handled by bundler)
  const googleMod = safeRequire("@ai-sdk/google") as any
  const googleFn = googleMod?.google
  if (typeof googleFn === "function") {
    return googleFn(modelId, { apiKey })
  }

  // Final fallback: use the generic openproviders helper which already imports the correct SDK.
  // This avoids `require` entirely and works in ESM-only production builds.
  return openproviders(modelId as any, undefined as any, apiKey)
}

const geminiModels: ModelConfig[] = [
  {
    id: "gemini-1.5-flash-002",
    name: "Gemini 1.5 Flash 002",
    provider: "Google",
    providerId: "google",
    modelFamily: "Gemini",
    description: "Fast, low-latency Gemini model optimized for responsiveness.",
    tags: ["fast", "multimodal", "vision"],
    contextWindow: 1000000,
    inputCost: 0.075,
    outputCost: 0.3,
    priceUnit: "per 1M tokens",
    vision: true,
    tools: true,
    audio: true,
    reasoning: false,
    openSource: false,
    speed: "Fast",
    intelligence: "Medium",
    website: "https://gemini.google.com",
    apiDocs: "https://ai.google.dev/api/docs",
    modelPage: "https://deepmind.google/technologies/gemini",
    icon: "gemini",
    apiSdk: (apiKey?: string) => getGeminiSdk("gemini-1.5-flash-002", apiKey),
  },
  {
    id: "gemini-1.5-flash-8b",
    name: "Gemini 1.5 Flash 8B",
    provider: "Google",
    providerId: "google",
    modelFamily: "Gemini",
    description: "Small-scale Gemini Flash model with good performance.",
    tags: ["cheap", "fast", "efficient"],
    contextWindow: 1000000,
    inputCost: 0.0375,
    outputCost: 0.15,
    priceUnit: "per 1M tokens",
    vision: true,
    tools: true,
    audio: true,
    reasoning: false,
    openSource: false,
    speed: "Fast",
    intelligence: "Low",
    website: "https://gemini.google.com",
    apiDocs: "https://ai.google.dev/api/docs",
    modelPage: "https://deepmind.google/technologies/gemini",
    icon: "gemini",
    apiSdk: (apiKey?: string) => getGeminiSdk("gemini-1.5-flash-8b", apiKey),
  },
  {
    id: "gemini-1.5-pro-002",
    name: "Gemini 1.5 Pro 002",
    provider: "Google",
    providerId: "google",
    modelFamily: "Gemini",
    description: "Multimodal flagship model with strong reasoning and code.",
    tags: ["multimodal", "vision", "reasoning", "flagship", "code"],
    contextWindow: 2000000,
    inputCost: 1.25,
    outputCost: 5.0,
    priceUnit: "per 1M tokens",
    vision: true,
    tools: true,
    audio: true,
    reasoning: true,
    openSource: false,
    speed: "Medium",
    intelligence: "High",
    website: "https://gemini.google.com",
    apiDocs: "https://ai.google.dev/api/docs",
    modelPage: "https://deepmind.google/technologies/gemini",
    releasedAt: "2024-02-15",
    icon: "gemini",
    apiSdk: (apiKey?: string) =>
      openproviders("gemini-1.5-pro-002", undefined, apiKey),
  },
  {
    id: "gemini-2.0-flash-001",
    name: "Gemini 2.0 Flash",
    provider: "Google",
    providerId: "google",
    modelFamily: "Gemini",
    description: "Gemini 2 Flash model tuned for ultra-low latency tasks.",
    tags: ["fast", "multimodal", "next-gen"],
    contextWindow: 1000000,
    inputCost: 0.075,
    outputCost: 0.3,
    priceUnit: "per 1M tokens",
    vision: true,
    tools: true,
    audio: true,
    reasoning: false,
    openSource: false,
    speed: "Fast",
    intelligence: "Medium",
    website: "https://gemini.google.com",
    apiDocs: "https://ai.google.dev/api/docs",
    modelPage: "https://deepmind.google/technologies/gemini",
    releasedAt: "2024-12-11",
    icon: "gemini",
    apiSdk: (apiKey?: string) =>
      openproviders("gemini-2.0-flash-001", undefined, apiKey),
  },
  {
    id: "gemini-2.0-flash-lite-preview-02-05",
    name: "Gemini 2.0 Flash Lite Preview",
    provider: "Google",
    providerId: "google",
    modelFamily: "Gemini",
    description: "Lite preview version of Gemini 2.0 Flash.",
    tags: ["preview", "lite", "fast", "experimental"],
    contextWindow: 500000,
    inputCost: 0.0375,
    outputCost: 0.15,
    priceUnit: "per 1M tokens",
    vision: true,
    tools: true,
    audio: false,
    reasoning: false,
    openSource: false,
    speed: "Fast",
    intelligence: "Low",
    website: "https://gemini.google.com",
    apiDocs: "https://ai.google.dev/api/docs",
    modelPage: "https://deepmind.google/technologies/gemini",
    icon: "gemini",
    apiSdk: (apiKey?: string) =>
      openproviders("gemini-2.0-flash-lite-preview-02-05", undefined, apiKey),
  },
  {
    id: "gemini-2.5-pro-exp-03-25",
    name: "Gemini 2.5 Flash Preview",
    provider: "Google",
    providerId: "google",
    modelFamily: "Gemini",
    description:
      "Preview of the next-gen Gemini Flash with multimodal support.",
    tags: ["preview", "next-gen", "multimodal", "experimental"],
    contextWindow: 1000000,
    inputCost: 0.1,
    outputCost: 0.4,
    priceUnit: "per 1M tokens",
    vision: true,
    tools: true,
    audio: true,
    reasoning: true,
    openSource: false,
    speed: "Fast",
    intelligence: "Medium",
    website: "https://gemini.google.com",
    apiDocs: "https://ai.google.dev/api/docs",
    modelPage: "https://deepmind.google/technologies/gemini",
    icon: "gemini",
    apiSdk: (apiKey?: string) =>
      openproviders("gemini-2.5-pro-exp-03-25", undefined, apiKey),
  },
  {
    id: "gemini-2.5-pro-preview-03-25",
    name: "Gemini 2.5 Pro Preview",
    provider: "Google",
    providerId: "google",
    modelFamily: "Gemini",
    description: "Preview of Gemini 2.5 Pro with higher quota limits.",
    tags: ["preview", "pro", "reasoning", "experimental"],
    contextWindow: 2000000,
    inputCost: 2.5,
    outputCost: 10.0,
    priceUnit: "per 1M tokens",
    vision: true,
    tools: true,
    audio: true,
    reasoning: true,
    openSource: false,
    speed: "Medium",
    intelligence: "High",
    website: "https://gemini.google.com",
    apiDocs: "https://ai.google.dev/api/docs",
    modelPage: "https://deepmind.google/technologies/gemini",
    releasedAt: "2025-03-25",
    icon: "gemini",
    apiSdk: (apiKey?: string) => getGeminiSdk("gemini-2.5-pro-preview-03-25", apiKey),
  },
  {
    id: "gemma-3-27b-it",
    name: "Gemma 3 27B",
    provider: "Google",
    providerId: "google",
    modelFamily: "Gemma",
    description:
      "Open-source 27B model designed for local inference and experimentation.",
    tags: ["open-source", "OSS", "local", "research"],
    contextWindow: 8192,
    inputCost: 0.0,
    outputCost: 0.0,
    priceUnit: "per 1M tokens",
    vision: false,
    tools: true,
    audio: false,
    reasoning: true,
    openSource: true,
    speed: "Medium",
    intelligence: "Medium",
    website: "https://gemini.google.com",
    apiDocs: "https://ai.google.dev/api/docs",
    modelPage: "https://ai.google.dev/gemma",
    releasedAt: "2024-12-01",
    icon: "gemini",
    apiSdk: (apiKey?: string) =>
      openproviders("gemma-3-27b-it", undefined, apiKey),
  },
  {
    id: "gemini-2.5-pro",
    name: "Gemini 2.5 Pro",
    provider: "Google",
    providerId: "google",
    modelFamily: "Gemini",
    description: "GA release of Gemini 2.5 Pro â€“ multimodal flagship model (context-cache supported).",
    tags: ["pro", "flagship", "multimodal", "ga"],
    contextWindow: 2000000,
    inputCost: 2.5,
    outputCost: 10.0,
    priceUnit: "per 1M tokens",
    vision: true,
    tools: true,
    audio: true,
    reasoning: true,
    openSource: false,
    speed: "Medium",
    intelligence: "High",
    website: "https://gemini.google.com",
    apiDocs: "https://ai.google.dev/api/docs",
    modelPage: "https://cloud.google.com/vertex-ai/generative-ai/docs/models/gemini/2-5-pro",
    releasedAt: "2025-06-17",
    icon: "gemini",
    apiSdk: (apiKey?: string) => getGeminiSdk("gemini-2.5-pro", apiKey),
  },
]

export { geminiModels }
